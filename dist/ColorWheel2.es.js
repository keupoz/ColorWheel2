var version = "1.2.0";

var aliceblue = "#f0f8ff";
var antiquewhite = "#faebd7";
var aqua = "#00ffff";
var aquamarine = "#7fffd4";
var azure = "#f0ffff";
var beige = "#f5f5dc";
var bisque = "#ffe4c4";
var black = "#000000";
var blanchedalmond = "#ffebcd";
var blue = "#0000ff";
var blueviolet = "#8a2be2";
var brown = "#a52a2a";
var burlywood = "#deb887";
var cadetblue = "#5f9ea0";
var chartreuse = "#7fff00";
var chocolate = "#d2691e";
var coral = "#ff7f50";
var cornflowerblue = "#6495ed";
var cornsilk = "#fff8dc";
var crimson = "#dc143c";
var cyan = "#00ffff";
var darkblue = "#00008b";
var darkcyan = "#008b8b";
var darkgoldenrod = "#b8860b";
var darkgray = "#a9a9a9";
var darkgreen = "#006400";
var darkgrey = "#a9a9a9";
var darkkhaki = "#bdb76b";
var darkmagenta = "#8b008b";
var darkolivegreen = "#556b2f";
var darkorange = "#ff8c00";
var darkorchid = "#9932cc";
var darkred = "#8b0000";
var darksalmon = "#e9967a";
var darkseagreen = "#8fbc8f";
var darkslateblue = "#483d8b";
var darkslategray = "#2f4f4f";
var darkslategrey = "#2f4f4f";
var darkturquoise = "#00ced1";
var darkviolet = "#9400d3";
var deeppink = "#ff1493";
var deepskyblue = "#00bfff";
var dimgray = "#696969";
var dimgrey = "#696969";
var dodgerblue = "#1e90ff";
var firebrick = "#b22222";
var floralwhite = "#fffaf0";
var forestgreen = "#228b22";
var fuchsia = "#ff00ff";
var gainsboro = "#dcdcdc";
var ghostwhite = "#f8f8ff";
var goldenrod = "#daa520";
var gold = "#ffd700";
var gray = "#808080";
var green = "#008000";
var greenyellow = "#adff2f";
var grey = "#808080";
var honeydew = "#f0fff0";
var hotpink = "#ff69b4";
var indianred = "#cd5c5c";
var indigo = "#4b0082";
var ivory = "#fffff0";
var khaki = "#f0e68c";
var lavenderblush = "#fff0f5";
var lavender = "#e6e6fa";
var lawngreen = "#7cfc00";
var lemonchiffon = "#fffacd";
var lightblue = "#add8e6";
var lightcoral = "#f08080";
var lightcyan = "#e0ffff";
var lightgoldenrodyellow = "#fafad2";
var lightgray = "#d3d3d3";
var lightgreen = "#90ee90";
var lightgrey = "#d3d3d3";
var lightpink = "#ffb6c1";
var lightsalmon = "#ffa07a";
var lightseagreen = "#20b2aa";
var lightskyblue = "#87cefa";
var lightslategray = "#778899";
var lightslategrey = "#778899";
var lightsteelblue = "#b0c4de";
var lightyellow = "#ffffe0";
var lime = "#00ff00";
var limegreen = "#32cd32";
var linen = "#faf0e6";
var magenta = "#ff00ff";
var maroon = "#800000";
var mediumaquamarine = "#66cdaa";
var mediumblue = "#0000cd";
var mediumorchid = "#ba55d3";
var mediumpurple = "#9370db";
var mediumseagreen = "#3cb371";
var mediumslateblue = "#7b68ee";
var mediumspringgreen = "#00fa9a";
var mediumturquoise = "#48d1cc";
var mediumvioletred = "#c71585";
var midnightblue = "#191970";
var mintcream = "#f5fffa";
var mistyrose = "#ffe4e1";
var moccasin = "#ffe4b5";
var navajowhite = "#ffdead";
var navy = "#000080";
var oldlace = "#fdf5e6";
var olive = "#808000";
var olivedrab = "#6b8e23";
var orange = "#ffa500";
var orangered = "#ff4500";
var orchid = "#da70d6";
var palegoldenrod = "#eee8aa";
var palegreen = "#98fb98";
var paleturquoise = "#afeeee";
var palevioletred = "#db7093";
var papayawhip = "#ffefd5";
var peachpuff = "#ffdab9";
var peru = "#cd853f";
var pink = "#ffc0cb";
var plum = "#dda0dd";
var powderblue = "#b0e0e6";
var purple = "#800080";
var rebeccapurple = "#663399";
var red = "#ff0000";
var rosybrown = "#bc8f8f";
var royalblue = "#4169e1";
var saddlebrown = "#8b4513";
var salmon = "#fa8072";
var sandybrown = "#f4a460";
var seagreen = "#2e8b57";
var seashell = "#fff5ee";
var sienna = "#a0522d";
var silver = "#c0c0c0";
var skyblue = "#87ceeb";
var slateblue = "#6a5acd";
var slategray = "#708090";
var slategrey = "#708090";
var snow = "#fffafa";
var springgreen = "#00ff7f";
var steelblue = "#4682b4";
var tan = "#d2b48c";
var teal = "#008080";
var thistle = "#d8bfd8";
var tomato = "#ff6347";
var turquoise = "#40e0d0";
var violet = "#ee82ee";
var wheat = "#f5deb3";
var white = "#ffffff";
var whitesmoke = "#f5f5f5";
var yellow = "#ffff00";
var yellowgreen = "#9acd32";
var COLORS_JSON = {
	aliceblue: aliceblue,
	antiquewhite: antiquewhite,
	aqua: aqua,
	aquamarine: aquamarine,
	azure: azure,
	beige: beige,
	bisque: bisque,
	black: black,
	blanchedalmond: blanchedalmond,
	blue: blue,
	blueviolet: blueviolet,
	brown: brown,
	burlywood: burlywood,
	cadetblue: cadetblue,
	chartreuse: chartreuse,
	chocolate: chocolate,
	coral: coral,
	cornflowerblue: cornflowerblue,
	cornsilk: cornsilk,
	crimson: crimson,
	cyan: cyan,
	darkblue: darkblue,
	darkcyan: darkcyan,
	darkgoldenrod: darkgoldenrod,
	darkgray: darkgray,
	darkgreen: darkgreen,
	darkgrey: darkgrey,
	darkkhaki: darkkhaki,
	darkmagenta: darkmagenta,
	darkolivegreen: darkolivegreen,
	darkorange: darkorange,
	darkorchid: darkorchid,
	darkred: darkred,
	darksalmon: darksalmon,
	darkseagreen: darkseagreen,
	darkslateblue: darkslateblue,
	darkslategray: darkslategray,
	darkslategrey: darkslategrey,
	darkturquoise: darkturquoise,
	darkviolet: darkviolet,
	deeppink: deeppink,
	deepskyblue: deepskyblue,
	dimgray: dimgray,
	dimgrey: dimgrey,
	dodgerblue: dodgerblue,
	firebrick: firebrick,
	floralwhite: floralwhite,
	forestgreen: forestgreen,
	fuchsia: fuchsia,
	gainsboro: gainsboro,
	ghostwhite: ghostwhite,
	goldenrod: goldenrod,
	gold: gold,
	gray: gray,
	green: green,
	greenyellow: greenyellow,
	grey: grey,
	honeydew: honeydew,
	hotpink: hotpink,
	indianred: indianred,
	indigo: indigo,
	ivory: ivory,
	khaki: khaki,
	lavenderblush: lavenderblush,
	lavender: lavender,
	lawngreen: lawngreen,
	lemonchiffon: lemonchiffon,
	lightblue: lightblue,
	lightcoral: lightcoral,
	lightcyan: lightcyan,
	lightgoldenrodyellow: lightgoldenrodyellow,
	lightgray: lightgray,
	lightgreen: lightgreen,
	lightgrey: lightgrey,
	lightpink: lightpink,
	lightsalmon: lightsalmon,
	lightseagreen: lightseagreen,
	lightskyblue: lightskyblue,
	lightslategray: lightslategray,
	lightslategrey: lightslategrey,
	lightsteelblue: lightsteelblue,
	lightyellow: lightyellow,
	lime: lime,
	limegreen: limegreen,
	linen: linen,
	magenta: magenta,
	maroon: maroon,
	mediumaquamarine: mediumaquamarine,
	mediumblue: mediumblue,
	mediumorchid: mediumorchid,
	mediumpurple: mediumpurple,
	mediumseagreen: mediumseagreen,
	mediumslateblue: mediumslateblue,
	mediumspringgreen: mediumspringgreen,
	mediumturquoise: mediumturquoise,
	mediumvioletred: mediumvioletred,
	midnightblue: midnightblue,
	mintcream: mintcream,
	mistyrose: mistyrose,
	moccasin: moccasin,
	navajowhite: navajowhite,
	navy: navy,
	oldlace: oldlace,
	olive: olive,
	olivedrab: olivedrab,
	orange: orange,
	orangered: orangered,
	orchid: orchid,
	palegoldenrod: palegoldenrod,
	palegreen: palegreen,
	paleturquoise: paleturquoise,
	palevioletred: palevioletred,
	papayawhip: papayawhip,
	peachpuff: peachpuff,
	peru: peru,
	pink: pink,
	plum: plum,
	powderblue: powderblue,
	purple: purple,
	rebeccapurple: rebeccapurple,
	red: red,
	rosybrown: rosybrown,
	royalblue: royalblue,
	saddlebrown: saddlebrown,
	salmon: salmon,
	sandybrown: sandybrown,
	seagreen: seagreen,
	seashell: seashell,
	sienna: sienna,
	silver: silver,
	skyblue: skyblue,
	slateblue: slateblue,
	slategray: slategray,
	slategrey: slategrey,
	snow: snow,
	springgreen: springgreen,
	steelblue: steelblue,
	tan: tan,
	teal: teal,
	thistle: thistle,
	tomato: tomato,
	turquoise: turquoise,
	violet: violet,
	wheat: wheat,
	white: white,
	whitesmoke: whitesmoke,
	yellow: yellow,
	yellowgreen: yellowgreen
};

function clamp(min, max, number) {
    return Math.max(min, Math.min(number, max));
}
function clamp1(number) {
    return clamp(0, 1, number);
}
function clamp360(deg) {
    deg -= 360 * (deg / 360 | 0);
    if (deg < 0)
        deg += 360;
    return Math.round(deg);
}
function sv2sl(s, v) {
    var a = (2 - s) * v;
    s = s * v / (a <= 1 ? a : 2 - a) || 0;
    v = a / 2;
    return [s, v];
}
function sl2sv(s, l) {
    s *= l < 0.5 ? l : 1 - l;
    l += s;
    s = 2 * s / l;
    return [s, l];
}
function on(el, events, handler) {
    events.split(" ").forEach(function (event) { return el.addEventListener(event, handler); });
}
function isTouchEvent(event) {
    return Array.isArray(event.changedTouches);
}
function getPoint(event) {
    var _a = isTouchEvent(event) ? event.changedTouches[0] : event, x = _a.clientX, y = _a.clientY;
    return { x: x, y: y };
}

var NAMES = {}, COLORS = COLORS_JSON;
Object.keys(COLORS).forEach(function (name) {
    NAMES[COLORS[name]] = name;
});
var Color = /** @class */ (function () {
    function Color(h, s, v) {
        this.num = 0x000000;
        this.hex = "#000000";
        this.css = "";
        this.HSV = [0, 0, 0];
        this.HSL = [0, 0, 0];
        this.RGB = [0, 0, 0];
        this.setHSV(h, s, v);
    }
    Color.prototype.isDark = function () {
        var RGB = this.RGB;
        return 0.299 * RGB[0] + 0.587 * RGB[1] + 0.114 * RGB[2] <= 127.5;
    };
    Color.prototype.getName = function () {
        return NAMES[this.hex] || this.hex;
    };
    Color.prototype.setHSV = function (h, s, v) {
        this.HSV[0] = clamp360(h);
        this.HSV[1] = clamp1(s);
        this.HSV[2] = clamp1(v);
        this.updateHSL();
        this.updateCSS();
        this.updateRGB();
        this.updateNUM();
        this.updateHEX();
    };
    Color.prototype.setHSL = function (h, s, l) {
        this.HSL[0] = clamp360(h);
        this.HSL[1] = clamp1(s);
        this.HSL[2] = clamp1(l);
        this.updateHSV();
        this.updateCSS();
        this.updateRGB();
        this.updateNUM();
        this.updateHEX();
    };
    Color.prototype.setRGB = function (r, g, b) {
        this.RGB[0] = r & 0xff;
        this.RGB[1] = g & 0xff;
        this.RGB[2] = b & 0xff;
        this.updateHSVfromRGB();
        this.updateHSL();
        this.updateCSS();
        this.updateNUM();
        this.updateHEX();
    };
    Color.prototype.setHEX = function (hex) {
        var num = parseInt(hex.replace("#", ""), 16);
        if (isNaN(num))
            throw new TypeError("Color: invalid hex code");
        this.setNUM(num);
    };
    Color.prototype.setName = function (name) {
        name = name.replace(/\s+/g, "").toLowerCase();
        if (name in COLORS)
            this.setHEX(COLORS[name]);
        else
            this.setHEX(name);
    };
    Color.prototype.setNUM = function (num) {
        this.num = num & 0xffffff;
        this.updateHEX();
        this.updateRGBfromNUM();
        this.updateHSVfromRGB();
        this.updateHSL();
        this.updateCSS();
    };
    Color.prototype.setHue = function (hue) {
        this.HSV[0] = this.HSL[0] = clamp360(hue);
        this.updateCSS();
        this.updateRGB();
        this.updateNUM();
        this.updateHEX();
    };
    Color.prototype.setSV = function (s, v) {
        this.setHSV(this.HSV[0], s, v);
    };
    Color.prototype.updateHSV = function () {
        var _a = this.HSL, h = _a[0], sl = _a[1], l = _a[2], _b = sl2sv(sl, l), sv = _b[0], v = _b[1];
        this.HSV[0] = h;
        this.HSV[1] = sv;
        this.HSV[2] = v;
    };
    Color.prototype.updateHSVfromRGB = function () {
        var _a = this, RGB = _a.RGB, HSV = _a.HSV, r = RGB[0], g = RGB[1], b = RGB[2], min = Math.min(r, g, b), max = Math.max(r, g, b), diff = max - min;
        if (max !== min)
            switch (max) {
                case r:
                    HSV[0] = 60 * (g - b) / diff + (g < b ? 360 : 0);
                    break;
                case g:
                    HSV[0] = 60 * (b - r) / diff + 120;
                    break;
                case b:
                    HSV[0] = 60 * (r - g) / diff + 240;
                    break;
            }
        HSV[1] = max == 0 ? 0 : 1 - min / max;
        HSV[2] = max / 0xff;
    };
    Color.prototype.updateHSL = function () {
        var _a = this.HSV, h = _a[0], sv = _a[1], v = _a[2], _b = sv2sl(sv, v), sl = _b[0], l = _b[1];
        this.HSL[0] = h;
        this.HSL[1] = sl;
        this.HSL[2] = l;
    };
    Color.prototype.updateCSS = function () {
        var _a = this.HSL, h = _a[0], s = _a[1], l = _a[2];
        this.css = "hsl(" + h + "," + s * 100 + "%," + l * 100 + "%)";
    };
    // https://gist.github.com/mjackson/5311256
    Color.prototype.updateRGB = function () {
        var _a = this, RGB = _a.RGB, HSV = _a.HSV, h = HSV[0], s = HSV[1], v = HSV[2], h1 = Math.floor((h / 60) % 6), vmin = (1 - s) * v, a = (v - vmin) * (h % 60) / 60, vinc = vmin + a, vdec = v - a;
        var c;
        switch (h1) {
            case 0:
                c = [v, vinc, vmin];
                break;
            case 1:
                c = [vdec, v, vmin];
                break;
            case 2:
                c = [vmin, v, vinc];
                break;
            case 3:
                c = [vmin, vdec, v];
                break;
            case 4:
                c = [vinc, vmin, v];
                break;
            case 5:
                c = [v, vmin, vdec];
                break;
        }
        c.forEach(function (val, i) { return RGB[i] = (val * 0xff) & 0xff; });
    };
    Color.prototype.updateRGBfromNUM = function () {
        var _a = this, RGB = _a.RGB, num = _a.num;
        RGB[0] = num >> 16;
        RGB[1] = num >> 8 & 0xff;
        RGB[2] = num & 0xff;
    };
    Color.prototype.updateNUM = function () {
        var _a = this.RGB, r = _a[0], g = _a[1], b = _a[2];
        this.num = (r << 16) + (g << 8) + b;
    };
    Color.prototype.updateHEX = function () {
        this.hex = "#" + this.num.toString(16).padStart(6, "0");
    };
    return Color;
}());

var FULL_ARC = Math.PI * 2, DEG = Math.PI / 180, RAD_30 = Math.PI / 6, RAD_60 = Math.PI / 3, RAD_90 = Math.PI / 2, SQRT_3 = Math.sqrt(3), SIN_60 = SQRT_3 / 2, SATURATION_GRADIENT_Y_MULTIPLIER = SQRT_3 / 4;

/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
/* global Reflect, Promise */

var extendStatics = function(d, b) {
    extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return extendStatics(d, b);
};

function __extends(d, b) {
    extendStatics(d, b);
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}

var Layer = /** @class */ (function () {
    function Layer(el, ctx, options) {
        this.options = options;
        this.el = el || document.createElement("canvas");
        ctx = ctx || this.el.getContext("2d");
        if (ctx === null)
            throw new Error("Couldn't initialize canvas context");
        this.ctx = ctx;
    }
    Layer.prototype.setSize = function (size) {
        this.el.width = this.el.height = size;
    };
    Layer.prototype.update = function () {
        this.setSize(this.options.size);
        this.render();
    };
    Layer.prototype.output = function (ctx) {
        ctx.drawImage(this.el, 0, 0);
    };
    Layer.prototype.render = function () {
        this.clear();
        this.safe(this.renderFn.bind(this));
    };
    Layer.prototype.safe = function (cb) {
        this.ctx.save();
        cb();
        this.ctx.restore();
    };
    Layer.prototype.path = function (cb) {
        this.ctx.beginPath();
        cb();
        this.ctx.closePath();
    };
    Layer.prototype.clear = function () {
        var size = this.options.size;
        this.ctx.clearRect(0, 0, size, size);
    };
    Layer.prototype.center = function () {
        var center = this.options.center;
        this.ctx.translate(center, center);
    };
    return Layer;
}());

var Background = /** @class */ (function (_super) {
    __extends(Background, _super);
    function Background(options) {
        return _super.call(this, null, null, options) || this;
    }
    Background.prototype.renderFn = function () {
        var _a = this.options, radius = _a.radius, spectreThickness = _a.spectreThickness, triangleRadius = _a.triangleRadius, ctx = this.ctx;
        this.center();
        // Background with center shadow
        this.path(function () {
            ctx.arc(0, 0, radius, 0, FULL_ARC);
            var gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, radius);
            gradient.addColorStop(0, "#000");
            gradient.addColorStop(1, "#555");
            ctx.fillStyle = gradient;
            ctx.fill();
        });
        // Center circle
        this.path(function () {
            ctx.arc(0, 0, radius - 2 * spectreThickness, 0, FULL_ARC);
            ctx.fillStyle = "#444";
            ctx.fill();
        });
        // Spectre wheel
        var spectreRadius = radius - spectreThickness / 2;
        ctx.lineWidth = spectreThickness;
        var _loop_1 = function (deg) {
            this_1.path(function () {
                ctx.arc(0, 0, spectreRadius, deg * DEG, (deg + 1.5) * DEG);
                ctx.strokeStyle = "hsl(" + -deg + ",100%,50%)";
                ctx.stroke();
            });
        };
        var this_1 = this;
        for (var deg = 0; deg < 360; deg++) {
            _loop_1(deg);
        }
        // Triangle path
        this.path(function () {
            ctx.arc(0, 0, triangleRadius, 0, FULL_ARC);
            ctx.fillStyle = "rgba(68,68,68,0.25)";
            ctx.fill();
        });
    };
    return Background;
}(Layer));

var Cursor = /** @class */ (function (_super) {
    __extends(Cursor, _super);
    function Cursor(options) {
        return _super.call(this, null, null, options) || this;
    }
    Cursor.prototype.renderFn = function () {
        var _a = this.options, color = _a.color, hueRad = _a.hueRad, _b = _a.cursor, x = _b.x, y = _b.y, triangleBorder = _a.triangleBorder, ctx = this.ctx;
        this.center();
        ctx.rotate(-hueRad);
        this.path(function () {
            ctx.arc(x, y, 5, 0, FULL_ARC);
            ctx.strokeStyle = "whitesmoke";
            ctx.lineWidth = triangleBorder;
            ctx.fillStyle = color.css;
            ctx.stroke();
            ctx.fill();
        });
    };
    return Cursor;
}(Layer));

var Output = /** @class */ (function (_super) {
    __extends(Output, _super);
    function Output(el, options) {
        var layers = [];
        for (var _i = 2; _i < arguments.length; _i++) {
            layers[_i - 2] = arguments[_i];
        }
        var _this = this;
        var ctx = null;
        if (typeof el == "string")
            el = document.querySelector(el);
        if (el instanceof CanvasRenderingContext2D) {
            ctx = el;
            el = null;
        }
        else if (!(el instanceof HTMLCanvasElement))
            el = null;
        _this = _super.call(this, el, ctx, options) || this;
        _this.layers = layers;
        return _this;
    }
    Output.prototype.getDomElement = function () {
        return this.el;
    };
    Output.prototype.update = function () {
        this.layers.forEach(function (layer) { return layer.update(); });
        _super.prototype.update.call(this);
    };
    Output.prototype.renderFn = function () {
        var _this = this;
        this.layers.forEach(function (layer) { return layer.output(_this.ctx); });
    };
    return Output;
}(Layer));

var Triangle = /** @class */ (function (_super) {
    __extends(Triangle, _super);
    function Triangle(options) {
        return _super.call(this, null, null, options) || this;
    }
    Triangle.prototype.update = function () {
        var _a = this.options, vertices = _a.vertices, triangleRadius = _a.triangleRadius;
        var saturationGradient = this.ctx.createLinearGradient(vertices[2].x, vertices[2].y, triangleRadius / 4, triangleRadius * SATURATION_GRADIENT_Y_MULTIPLIER), brightnessGradient = this.ctx.createLinearGradient(vertices[1].x, vertices[0].y, vertices[0].x, vertices[0].y);
        saturationGradient.addColorStop(0, "white");
        saturationGradient.addColorStop(1, "rgba(255,255,255,0)");
        brightnessGradient.addColorStop(0, "black");
        brightnessGradient.addColorStop(1, "transparent");
        this.brightnessGradient = brightnessGradient;
        this.saturationGradient = saturationGradient;
        _super.prototype.update.call(this);
    };
    Triangle.prototype.renderFn = function () {
        var _a = this, ctx = _a.ctx, brightnessGradient = _a.brightnessGradient, saturationGradient = _a.saturationGradient, _b = this.options, HSL = _b.color.HSL, hueRad = _b.hueRad, vertices = _b.vertices, triangleBorder = _b.triangleBorder;
        this.center();
        ctx.rotate(-hueRad);
        // Triangle shape
        this.path(function () {
            ctx.moveTo(vertices[0].x, vertices[0].y);
            ctx.lineTo(vertices[1].x, vertices[1].y);
            ctx.lineTo(vertices[2].x, vertices[2].y);
        });
        // Hue filling
        ctx.fillStyle = "hsl(" + HSL[0] + ",100%,50%)";
        ctx.fill();
        // Saturation and brightness filling
        ctx.fillStyle = brightnessGradient;
        ctx.fill();
        this.safe(function () {
            ctx.globalCompositeOperation = "lighter";
            ctx.fillStyle = saturationGradient;
            ctx.fill();
        });
        // Stroke triangle
        ctx.strokeStyle = "whitesmoke";
        ctx.lineWidth = triangleBorder;
        ctx.stroke();
    };
    return Triangle;
}(Layer));

var ColorWheel = /** @class */ (function () {
    function ColorWheel(el, size, callback) {
        if (callback === void 0) { callback = function () { }; }
        var color = new Color(0, 1, 1);
        this.options = {
            vertices: [0, 0, 0].map(function () { return ({ x: 0, y: 0 }); }),
            cursor: { x: 0, y: 0 },
            hueRad: 0,
            color: color
        };
        this.color = color;
        this.callback = callback;
        var background = new Background(this.options), triangle = new Triangle(this.options), cursor = new Cursor(this.options), output = new Output(el, this.options, background, triangle, cursor);
        this.layers = { background: background, triangle: triangle, cursor: cursor, output: output };
        this.domElement = this.layers.output.getDomElement();
        this.setSize(size);
        on(this.domElement, "touchstart mousedown", this.dragStart.bind(this));
    }
    ColorWheel.prototype.setSize = function (size) {
        var center = size / 2, radius = center, spectreThickness = radius / 4, triangleRadius = radius - spectreThickness * 3 / 4, triangleHeight = 1.5 * triangleRadius, triangleBorder = radius / 32, vertices = this.options.vertices;
        vertices[0].x = triangleRadius;
        vertices[1].x = vertices[2].x = -triangleRadius / 2;
        vertices[1].y = triangleRadius * SIN_60;
        vertices[2].y = -vertices[1].y;
        var triangleSide = 2 * vertices[1].y;
        Object.assign(this.options, {
            size: size,
            center: center,
            radius: radius,
            spectreThickness: spectreThickness,
            triangleRadius: triangleRadius,
            triangleHeight: triangleHeight,
            triangleBorder: triangleBorder,
            triangleSide: triangleSide
        });
        this.updateCursor();
        this.layers.output.update();
    };
    ColorWheel.prototype.update = function () {
        this.options.hueRad = this.color.HSV[0] * DEG;
        this.updateCursor();
        this.layers.triangle.render();
        this.layers.cursor.render();
        this.layers.output.render();
        this.callback.call(this, 3, "update");
    };
    ColorWheel.prototype.updateCursor = function () {
        var HSV = this.color.HSV, _a = this.options, cursor = _a.cursor, vertices = _a.vertices, triangleHeight = _a.triangleHeight, triangleSide = _a.triangleSide;
        if (HSV[1]) {
            var saturationRad = HSV[1] * RAD_60, radius = HSV[2] * triangleHeight / Math.cos(saturationRad - RAD_30), angle = RAD_90 - saturationRad;
            cursor.x = radius * Math.cos(angle) + vertices[2].x;
            cursor.y = -radius * Math.sin(angle) - vertices[2].y;
        }
        else {
            cursor.x = vertices[1].x;
            cursor.y = vertices[1].y - HSV[2] * triangleSide;
        }
    };
    ColorWheel.prototype.relate = function (point) {
        var rect = this.domElement.getBoundingClientRect(), center = this.options.center;
        point.x = point.x - rect.left - center;
        point.y = -point.y + rect.top + center;
        return point;
    };
    ColorWheel.prototype.getHandler = function (point) {
        var cursorDistance = Math.hypot(point.x, point.y), _a = this.options, triangleRadius = _a.triangleRadius, radius = _a.radius, handler = undefined;
        if (cursorDistance >= triangleRadius && cursorDistance <= radius) {
            // Spectre wheel
            handler = this.rotateWheel;
        }
        else if (this.moveCursor(point, true)) {
            // Triangle
            handler = this.moveCursor;
        }
        if (handler) {
            return [handler.name, handler.bind(this)];
        }
        else {
            return null;
        }
    };
    ColorWheel.prototype.rotateWheel = function (point) {
        var x = point.x, y = point.y, hueRad = Math.acos(x / Math.hypot(x, y));
        if (y < 0)
            hueRad = FULL_ARC - hueRad;
        this.options.hueRad = hueRad;
        this.color.setHue(Math.round(hueRad / DEG));
        this.layers.triangle.render();
        this.layers.cursor.render();
        this.layers.output.render();
    };
    ColorWheel.prototype.moveCursor = function (point, start) {
        var x = point.x, y = point.y, _a = this.options, hueRad = _a.hueRad, vertices = _a.vertices, triangleSide = _a.triangleSide, triangleHeight = _a.triangleHeight, cursorDistance = Math.hypot(x, y), s, v;
        if (hueRad != 0) {
            var cursorAngle = Math.acos(x / cursorDistance);
            if (y < 0)
                cursorAngle = FULL_ARC - cursorAngle;
            var rotation = cursorAngle - hueRad;
            x = cursorDistance * Math.cos(rotation);
            y = cursorDistance * Math.sin(rotation);
        }
        var relativeX = x - vertices[1].x, saturationY = y - vertices[2].y, brightnessY = -y + vertices[1].y, saturationHypot = Math.hypot(relativeX, saturationY), brightnessHypot = Math.hypot(relativeX, brightnessY), saturationCos = saturationY / saturationHypot, brightnessCos = brightnessY / Math.hypot(relativeX, brightnessY);
        if (start)
            return saturationCos >= 0.5 && saturationCos <= 1 &&
                brightnessCos >= 0.5 && brightnessCos <= 1 && relativeX >= 0;
        if (relativeX < 0) {
            s = 0;
            v = saturationY / triangleSide;
        }
        else {
            var saturationRad = Math.acos(saturationCos), brightnessRad = Math.acos(brightnessCos);
            if (brightnessRad > RAD_60 && brightnessRad % RAD_30) {
                s = brightnessHypot * Math.cos(brightnessRad - RAD_60) / triangleSide;
            }
            else
                s = saturationRad / RAD_60;
            if (saturationRad > RAD_60 && saturationRad % RAD_30) {
                v = saturationHypot * Math.cos(saturationRad - RAD_60) / triangleSide;
            }
            else {
                v = saturationHypot * Math.cos(saturationRad - RAD_30) / triangleHeight;
            }
        }
        this.color.setSV(s, v);
        this.updateCursor();
        this.layers.cursor.render();
        this.layers.output.render();
    };
    ColorWheel.prototype.dragStart = function (e) {
        var _this = this;
        if ("button" in e && e.button !== 0)
            return;
        var point = this.relate(getPoint(e)), handlerObj = this.getHandler(point);
        if (!handlerObj)
            return;
        var name = handlerObj[0], handler = handlerObj[1];
        e.preventDefault();
        handler(point);
        this.callback(0, name);
        var body = document.body, touch = "changedTouches" in e, move = touch ? "touchmove" : "mousemove", end = touch ? "touchend" : "mouseup", cancel = touch ? "touchcancel" : "mouseleave";
        var moveHandler = (function (e) {
            handler(_this.relate(getPoint(e)));
            _this.callback(1, name);
        });
        var removeHandlers = function () {
            body.removeEventListener(move, moveHandler);
            body.removeEventListener(end, removeHandlers);
            body.removeEventListener(cancel, removeHandlers);
            _this.callback(2, name);
        };
        body.addEventListener(move, moveHandler);
        body.addEventListener(end, removeHandlers);
        body.addEventListener(cancel, removeHandlers);
    };
    ColorWheel.version = version;
    return ColorWheel;
}());

export default ColorWheel;
